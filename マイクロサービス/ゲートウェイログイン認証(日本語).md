# マイクロサービスアーキテクチャにおけるログイン認証設計
## 2.1.認証思路の分析
## モノリシックアーキテクチャ vs マイクロサービスアーキテクチャ
- **モノリシックアーキテクチャ**  
  ユーザーログインと身元確認を1回行うだけで、全ての業務でユーザー情報を共有可能

- **マイクロサービスアーキテクチャ**  
  - 各マイクロサービスは独立デプロイ、データ非共有  
  - 課題：各マイクロサービスで個別にログイン認証が必要 → **非推奨**

---

## 2.1 認証思路の分析
### JWTベース実装の課題点
各マイクロサービスでJWT検証を行う場合：
1. **セキュリティ問題**  
   - 各サービスにJWT秘密鍵の保存が必要  。
   - 鍵拡散による漏洩リスク↑
    
2. **保守問題**  
   - 認証/権限コードの重複実装  
   - アルゴリズム変更時の全サービス同期必要  

### 解決方案：ゲートウェイ統一認証
**メリット**：
- 秘密鍵の保存場所限定：  
  ✅ ゲートウェイサービス  
  ✅ ユーザーサービス（トークン生成時）  
- 認証ロジック集中管理、重複回避  

**認証フロー図**：  
<img src="imgs\a.png" alt="a.png">
ただし、以下の課題が残る：
- ゲートウェイルーティングは設定値であり、転送処理はGateway内部コードで実施されるため、転送前の認証をどう実装するか？
- ゲートウェイでJWT検証後、ユーザー情報をマイクロサービスにどう伝達するか？
- マイクロサービス間呼び出し（ゲートウェイ経由しない場合）のユーザー情報伝達方法は？

これらの課題については次節以降で解決する。
## 2.2.ゲートウェイフィルター
ログイン認証は必ずマイクロサービスへのリクエスト転送前に実施する必要がある（でなければ意味がない）。ゲートウェイのリクエスト転送はGateway内部コードで実装されるため、転送前認証を実現するにはGatewayの基本動作原理を理解する必要がある。
<img src="imgs\b.png" alt="b.png">
